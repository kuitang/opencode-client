<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Refresh Counter Test</title>
    <script src="https://unpkg.com/htmx.org@2.0.2"></script>
</head>
<body>
    <h1>Manual Refresh Counter Test</h1>
    <p>This test verifies that manual dropdown refresh also updates file and line counters.</p>

    <h2>Test Scenario:</h2>
    <ol>
        <li>Click on dropdown to trigger manual refresh</li>
        <li>Verify that file count updates</li>
        <li>Verify that line count updates</li>
        <li>Verify that dropdown options update</li>
    </ol>

    <div style="border: 1px solid #ccc; padding: 20px; margin: 20px 0;">
        <h3>Test Components</h3>

        <!-- File Counter -->
        <div id="file-count-container" style="background: #f0f0f0; padding: 10px; margin: 10px 0;">
            <p class="text-2xl font-semibold text-gray-900">0</p>
            <p class="text-sm text-gray-600">Files</p>
        </div>

        <!-- Line Counter -->
        <div id="line-count-container" style="background: #f0f0f0; padding: 10px; margin: 10px 0;">
            <p class="text-2xl font-semibold text-gray-900">0</p>
            <p class="text-sm text-gray-600">Lines of Code</p>
        </div>

        <!-- Dropdown -->
        <select id="file-selector"
                style="padding: 10px; width: 300px;"
                onfocus="htmx.ajax('GET', '/tab/code/filelist?options_only=true&current=' + encodeURIComponent(this.value), {target: this, swap: 'innerHTML'})">
            <option value="">Loading...</option>
        </select>
    </div>

    <h3>Test Instructions:</h3>
    <ol>
        <li>Start the server: <code>./opencode-chat -port 8080</code></li>
        <li>Create some files via the main chat interface</li>
        <li>Open this test page in a browser</li>
        <li>Click on the dropdown - it should update all three elements</li>
        <li>Check browser console for any errors</li>
    </ol>

    <h3>Expected Behavior:</h3>
    <ul>
        <li>✅ File count should show actual number of files</li>
        <li>✅ Line count should show total lines of code</li>
        <li>✅ Dropdown should show list of files</li>
        <li>✅ All three should update atomically when dropdown is focused</li>
    </ul>

    <script>
        // Monitor for OOB swaps
        document.body.addEventListener('htmx:oobAfterSwap', function(evt) {
            console.log('OOB Swap detected:', evt.detail.target.id);
        });

        // Monitor dropdown changes
        document.getElementById('file-selector').addEventListener('change', function(evt) {
            console.log('Dropdown value changed to:', evt.target.value);
        });

        // Log when dropdown gets focus
        document.getElementById('file-selector').addEventListener('focus', function(evt) {
            console.log('Dropdown focused - manual refresh triggered');
        });
    </script>
</body>
</html>