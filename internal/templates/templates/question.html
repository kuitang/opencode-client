{{define "question"}}
<div data-question-id="{{.RequestID}}" class="my-2 flex justify-start">
    <div class="max-w-[70%] p-3 rounded-lg break-words bg-amber-50 border border-amber-200 rounded-bl-none">
        <input type="hidden" name="question_count" value="{{len .Questions}}">
        {{range $qi, $q := .Questions}}
        <div class="{{if $qi}}mt-4 pt-3 border-t border-amber-200{{end}}">
            <div class="flex items-center gap-2 mb-1">
                <span class="px-2 py-0.5 bg-amber-200 text-amber-800 rounded text-xs font-medium">{{.Header}}</span>
            </div>
            <p class="text-gray-800 text-sm mb-2">{{.Question}}</p>
            <div class="space-y-1">
                {{range .Options}}
                <label class="flex items-start gap-2 p-2 rounded hover:bg-amber-100 cursor-pointer">
                    {{if $q.Multiple}}
                    <input type="checkbox" name="q{{$qi}}" value="{{.Label}}" class="mt-0.5">
                    {{else}}
                    <input type="radio" name="q{{$qi}}" value="{{.Label}}" class="mt-0.5">
                    {{end}}
                    <div>
                        <span class="text-sm font-medium">{{.Label}}</span>
                        {{if .Description}}
                        <span class="text-xs text-gray-500 ml-1">&mdash; {{.Description}}</span>
                        {{end}}
                    </div>
                </label>
                {{end}}
                <!-- Custom answer option -->
                <label class="flex items-start gap-2 p-2 rounded hover:bg-amber-100 cursor-pointer">
                    {{if $q.Multiple}}
                    <input type="checkbox" name="q{{$qi}}" value="__custom__" class="mt-0.5"
                           onchange="this.closest('[data-question-id]').querySelector('[name=q{{$qi}}_custom]').toggleAttribute('disabled', !this.checked)">
                    {{else}}
                    <input type="radio" name="q{{$qi}}" value="__custom__" class="mt-0.5"
                           onchange="this.closest('[data-question-id]').querySelector('[name=q{{$qi}}_custom]').disabled = false">
                    {{end}}
                    <div class="flex-1">
                        <span class="text-sm font-medium">Other</span>
                        <input type="text" name="q{{$qi}}_custom" placeholder="Type your answer..."
                               disabled
                               class="mt-1 w-full px-2 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:bg-gray-100">
                    </div>
                </label>
            </div>
        </div>
        {{end}}
        <div class="flex gap-2 mt-3">
            <button hx-post="/question/{{.RequestID}}/reply"
                    hx-include="closest [data-question-id]"
                    hx-target="closest [data-question-id]"
                    hx-swap="outerHTML"
                    class="px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors">
                Answer
            </button>
            <button hx-post="/question/{{.RequestID}}/reject"
                    hx-target="closest [data-question-id]"
                    hx-swap="outerHTML"
                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded text-sm hover:bg-gray-300 transition-colors">
                Dismiss
            </button>
        </div>
    </div>
</div>
{{end}}

{{define "question-answered"}}
<div class="my-2 flex justify-end">
    <div class="max-w-[70%] p-3 rounded-lg break-words bg-green-50 border border-green-200 rounded-br-none">
        <div class="text-sm text-green-800">{{.Summary}}</div>
    </div>
</div>
{{end}}

{{define "question-dismissed"}}
<div class="my-2 flex justify-end">
    <div class="max-w-[70%] p-3 rounded-lg break-words bg-gray-100 border border-gray-200 rounded-br-none">
        <div class="text-sm text-gray-500 italic">Question dismissed</div>
    </div>
</div>
{{end}}
