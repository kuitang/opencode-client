<!DOCTYPE html>
<html>
<head>
    <script src="https://unpkg.com/htmx.org@2.0.3"></script>
    <style>
        body { padding: 20px; font-family: sans-serif; }
        .test-section { margin: 40px 0; padding: 20px; border: 1px solid #ccc; }
        select { padding: 8px; min-width: 200px; }
    </style>
</head>
<body>
    <h1>Dropdown Refresh Solutions</h1>

    <div class="test-section">
        <h2>Solution 1: Refresh only the options (not the select element)</h2>
        <p>This preserves the dropdown open state by only swapping inner content</p>

        <select id="solution1-select"
                hx-get="http://localhost:8080/tab/code/filelist?options_only=true"
                hx-trigger="focus"
                hx-target="this"
                hx-swap="innerHTML">
            <option value="">Select a file...</option>
            <option value="old1.txt">old1.txt</option>
        </select>
    </div>

    <div class="test-section">
        <h2>Solution 2: Use click with delay</h2>
        <p>Delay the refresh to allow dropdown to open first</p>

        <select id="solution2-select"
                hx-get="http://localhost:8080/tab/code/filelist"
                hx-trigger="click delay:100ms"
                hx-target="this"
                hx-swap="outerHTML">
            <option value="">Select a file...</option>
            <option value="old2.txt">old2.txt</option>
        </select>
    </div>

    <div class="test-section">
        <h2>Solution 3: Refresh button next to dropdown</h2>
        <p>Explicit refresh control that doesn't interfere with dropdown</p>

        <div style="display: flex; gap: 10px; align-items: center;">
            <select id="solution3-select">
                <option value="">Select a file...</option>
                <option value="old3.txt">old3.txt</option>
            </select>
            <button hx-get="http://localhost:8080/tab/code/filelist"
                    hx-target="#solution3-select"
                    hx-swap="outerHTML">
                â†» Refresh
            </button>
        </div>
    </div>

    <div class="test-section">
        <h2>Solution 4: Focus with settle time</h2>
        <p>Use settle to ensure smooth transition</p>

        <div id="solution4-wrapper"
             hx-get="http://localhost:8080/tab/code/filelist"
             hx-trigger="focus from:#solution4-select once"
             hx-target="#solution4-select"
             hx-swap="outerHTML settle:500ms">
            <select id="solution4-select">
                <option value="">Select a file...</option>
                <option value="old4.txt">old4.txt</option>
            </select>
        </div>
    </div>

    <script>
        // Log all HTMX events
        document.body.addEventListener('htmx:beforeRequest', function(evt) {
            console.log('Request to:', evt.detail.pathInfo.requestPath);
        });

        document.body.addEventListener('htmx:afterRequest', function(evt) {
            console.log('Response:', evt.detail.xhr.status);
        });
    </script>
</body>
</html>